<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Discussion Forum</title>
        <link rel="stylesheet" href="css/styleh.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital@1&display=swap" rel="stylesheet">
    </head>
    
    <body>
        <header>
            <div class="logo">
                <img src="/css/images/logo.png" width="80" height="80"/>
            </div>
              <!--SearchBox Section-->
              <div class="search-box">
                
                <div class="feedback">
                  <button type="button" class="feedback-button"><i class="fa fa-plus"></i>&nbsp;Give Feedback</button>
                </div>
                  <div class="search-box-set">
                    <i class="fa fa-search"></i>
                      <input type="text" name="q" placeholder="search ...">
                  </div>
              </div>
          </header>
          <div class="navbar">
            <ul>
              <li><a class="active" href="#">Home</a></li>
              <!-- <li><a href="#">News</a></li>
              <li><a href="#">Contact</a></li> -->
              <li style="float:right"><a href="#" onclick="logout()">logout</a></li>
            </ul>
          </div>  
            
        <div class="container">
            <!--Navigation-->
            <!-- <div class="navigate">
                <span><a href="">&nbsp;</a> </span>
            </div> -->
    
            <!--Topic Section-->
            <div class="topic-container">
                <!--Original thread-->
                <div class="head">
                    <div class="authors">Title :</div>
                    <div class="content"> <span id="titledata"></span></div>
                </div>
    
                <div class="body">
                    <div class="authors">
                        <div class="username"><a href="">Description :</a></div>
                        <div>Role</div>
                        <img src="https://cdn.pixabay.com/photo/2015/11/06/13/27/ninja-1027877_960_720.jpg" alt="">
                        <div>Likes: <u>45</u></div>
                        <div>Posted at: <u>4586</u></div>
                    </div>
                    <div class="content">
                        <span id="bodydata"></span>
                        <br>
                        Regards username
                        <br>

                        <div class="divbox">
                            <div class="likes">
                                <i onclick="myFunction(this)" class="fa fa-thumbs-up likeicon"></i>
                            </div>
                            <a href="javascript:void(0);" class="btn btn-primary commentbtn" id="mpopupLink"> <i class="fa fa-comment size100"></i></a>
                        </div>
                        
                        <!-- Modal popup box -->
                        <div id="mpopupBox" class="mpopup">
                            <!-- Modal content -->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <span class="close">Ã—</span>
                                    <h2>Comments</h2>
                                </div>
                                <form onsubmit="commentsub(event)">
                                    <div class="modal-body">
                                        <p><textarea id="post" name="commentpost"></textarea></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button"  class="btn btn-primary button-15">Save</button>
                                    </div>
                                </form>
                                
                            </div>
                        </div>
                        <!--------End modal-------------->
                    </div>
                </div>
            </div>
    
            <!--Comment Area-->
            <div class="comment-area hide" id="comment-area">
                <textarea name="comment" id="" placeholder="comment here ... "></textarea>
                <input type="submit" value="submit">
            </div>
    
            <!--Comments Section-->
            <div class="comments-container">
                <div class="body">
                    <div class="authors">
                        <div class="username"><a href="">AnotherUser</a></div>
                        <div>Role</div>
                        <i class="fa fa-user size100"></i>
                    </div>
                    <div class="content">
                        Just a comment of the above random topic.
                        <br>To see how it looks like.
                        <br><br>
                        Nothing more and nothing less.
                        <br>
                        <!--<br>
                        <div class="comment">
                            <button onclick="showReply()">Reply</button>
                        </div> -->
                    </div>
                </div>
            </div>
            <!--Reply Area-->
            <div class="comment-area hide" id="reply-area">
                <textarea name="reply" id="" placeholder="reply here ... "></textarea>
                <input type="submit" value="submit">
            </div>
    
    
            <!--Another Comment With replies-->
            <div class="comments-container">
                <div class="body">
                    <div class="authors">
                        <div class="username"><a href="">AnotherUser</a></div>
                        <div>Role</div>
                        <i class="fa fa-user size100"></i>
                    </div>
                    <div class="content">
                        Just a comment of the above random topic.
                        <br>To see how it looks like.
                        <br><br>
                        Nothing more and nothing less.
                        <br>
                        <!-- <br>
                        <div class="comment">
                            <button onclick="showReply()">Reply</button>
                        </div> -->
                    </div>
                </div>
            </div>
            <!--Reply Area-->
            <div class="comment-area hide" id="reply-area">
                <textarea name="reply" id="" placeholder="reply here ... "></textarea>
                <input type="submit" value="submit">
            </div>
    
            
    
        </div>
    
    
    <script>
        console.log("window location:", window.location);

        let idname = window.location.search;
        console.log("Id:", idname );

        let urlParams = new URLSearchParams(idname);
        let contentid = urlParams.get("id")
        console.log("Id is:", contentid);

        window.onload = onPageLoad();
      function onPageLoad(){

        localStorage.setItem('logintoken',
                JSON.stringify(
                    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vYWNzLnZob3N0OjgwMDAvYXBpL2xvZ2luIiwiaWF0IjoxNjY3NDU4OTE4LCJleHAiOjE2Njc0NjI1MTgsIm5iZiI6MTY2NzQ1ODkxOCwianRpIjoiVmFiOEVPbHoxTG5lcTA2MiIsInN1YiI6IjciLCJwcnYiOiIyM2JkNWM4OTQ5ZjYwMGFkYjM5ZTcwMWM0MDA4NzJkYjdhNTk3NmY3In0.4gkTHAKf3VY3o_YISoQCzeTNN5UArKLn_DqBLNAeYoo'
                    )
            );

        let token = JSON.parse(localStorage.getItem('logintoken'));
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "http://acs.vhost:8000/api/post/"+contentid);
        xhr.withCredentials = true;
        xhr.responseType = 'json';
        // xhr.setRequestHeader("Authorization",'Bearer ' + token); 
        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
        //console.log(xhr);

        

        xhr.onload = () =>{
        if(xhr.status >= 400){
            console.log('failed');
        }
        else{
          var responsedata = JSON.stringify(xhr.response);      
          var jsonResult = JSON.parse(responsedata);
          document.getElementById("titledata").innerHTML=JSON.stringify(jsonResult.title);
          document.getElementById("bodydata").innerHTML=JSON.stringify(jsonResult.body);
          console.log(jsonResult);
        }
      };
       xhr.send();
      }

      function logout(){
            localStorage.clear();
            window.location.replace('/');
        }

    </script>
    <script>
        function commentsub(e){
            e.preventDefault();

                let commentdata= document.getElementsByName('commentpost');

                var data = new FormData();
                data.append('commentpost', commentdata[0].value);
                // data.append("commentpost", "abc deffghtyhyrhhrhrg wefewfwefw sdkdj");
                // data.append("like_dislike", "dislike");

                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;

                xhr.addEventListener("readystatechange", function() {
                if(this.readyState === 4) {
                    console.log(this.responseText);
                    //console.log()
                }
                });

                xhr.open("POST", "http://acs.vhost:8000/api/comment");
                xhr.setRequestHeader("eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vYWNzLnZob3N0OjgwMDAvYXBpL2xvZ2luIiwiaWF0IjoxNjY3NDU4OTE4LCJleHAiOjE2Njc0NjI1MTgsIm5iZiI6MTY2NzQ1ODkxOCwianRpIjoiVmFiOEVPbHoxTG5lcTA2MiIsInN1YiI6IjciLCJwcnYiOiIyM2JkNWM4OTQ5ZjYwMGFkYjM5ZTcwMWM0MDA4NzJkYjdhNTk3NmY3In0.4gkTHAKf3VY3o_YISoQCzeTNN5UArKLn_DqBLNAeYoo");

                xhr.send(data);
      }

    </script>
    <script>
        function myFunction(x) {
          x.classList.toggle("fa-thumbs-down");
        }
    </script>
    
    <!-------------------Modal Open----------------->
    <script>
        // Select modal
        var mpopup = document.getElementById('mpopupBox');
        
        // Select trigger link
        var mpLink = document.getElementById("mpopupLink");
        
        // Select close action element
        var close = document.getElementsByClassName("close")[0];
        
        // Open modal once the link is clicked
        mpLink.onclick = function() {
            mpopup.style.display = "block";
        };
        
        // Close modal once close element is clicked
        close.onclick = function() {
            mpopup.style.display = "none";
        };
        
        // Close modal when user clicks outside of the modal box
        window.onclick = function(event) {
            if (event.target == mpopup) {
                mpopup.style.display = "none";
            }
        };
        </script>
</body>
</html>